image: node:20-alpine

pages:
  script:
    - npm install
    - npm run build
    
    # --- HANDLING THE OUTPUT FOLDER ---
    # React apps usually build to 'build' (CRA) or 'dist' (Vite).
    # GitLab Pages ONLY looks in a folder named 'public'.
    # We remove the existing public folder (if any) and rename our build output.
    
    - rm -rf public
    # UNCOMMENT THE LINE BELOW THAT MATCHES YOUR TOOL:
    - mv build public   # Use this for Create React App
    # - mv dist public  # Use this for Vite

    # --- HANDLING REACT ROUTER (The SPA Fix) ---
    # This prevents 404 errors when refreshing a page like /about.
    # It copies index.html to 404.html so GitLab serves the app 
    # even on unknown routes.
    - cp public/index.html public/404.html

  artifacts:
    paths:
      - public
  rules:
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH